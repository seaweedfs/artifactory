name: "Mirror Base Images to GHCR"

on:
  schedule:
    # Run weekly on Sundays at 2 AM UTC
    - cron: '0 2 * * 0'
  workflow_dispatch:

permissions:
  packages: write
  contents: read

jobs:
  mirror-images:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - source: docker.io/library/golang:1.24-alpine
            target: ghcr.io/chrislusf/golang:1.24-alpine
          - source: docker.io/library/golang:1.24
            target: ghcr.io/chrislusf/golang:1.24
          - source: docker.io/library/alpine:latest
            target: ghcr.io/chrislusf/alpine:latest
          - source: docker.io/library/ubuntu:22.04
            target: ghcr.io/chrislusf/ubuntu:22.04
          - source: docker.io/library/ubuntu:20.04
            target: ghcr.io/chrislusf/ubuntu:20.04

    steps:
      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Login to GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.repository_owner }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Pull, tag, and push image
        run: |
          echo "Pulling ${{ matrix.source }}"
          docker pull ${{ matrix.source }}
          
          echo "Tagging as ${{ matrix.target }}"
          docker tag ${{ matrix.source }} ${{ matrix.target }}
          
          echo "Pushing to ${{ matrix.target }}"
          docker push ${{ matrix.target }}
          
          echo "âœ… Successfully mirrored ${{ matrix.source }} to ${{ matrix.target }}"
